# TradingView Pine Script 指標集合

這個專案包含了多個專業的TradingView Pine Script技術指標，專門為交易分析和市場研究而設計。

## 📊 指標列表

### 1. 原生段升段交易策略 (原生段升段檢測 v2.pine)
**功能描述：**
- 自動檢測連續3支陽燭形成的原生段
- 識別原生段後的升段趨勢
- 多層驗證系統確保信號品質
- 升段結束後的第2步監控分析
- **🚀 支援自動交易功能**

**核心邏輯：**
1. **原生段檢測**：尋找連續3支陽燭（收盤價高於開盤價）
2. **升段檢測**：在原生段成立後，持續監控每根K線是否符合以下條件：
   - 高點高過前一支K線的高點
   - 低點高過前一支K線的低點
3. **第1步驗證**：檢查升段中位價是否高於原生段前N支K線的最高價
4. **升段結束**：當出現一支陰燭時，升段結束（需陰燭確認）
5. **第2步監控**：升段結束後監控價格突破結束價格，計算1:1獲利目標

**驗證系統：**
- **中點價位檢查**：升段最高最低價中點需高於歷史100K最高價的指定百分比
- **第1步有效性**：升段中位價需高於原生段前N支K線最高價
- **第2步分析**：監控升段結束後的價格行為，尋找突破機會

**視覺特徵：**
- 🟡 黃色背景：第1支陽燭
- 🟠 橙色背景：第2支陽燭  
- 🟢 綠色背景：原生段成立（3支陽燭完成）
- 🔵 藍色背景：升段進行中
- 📍 綠色標籤：標記原生段位置和驗證資訊
- 📍 藍色標籤：標記升段結束位置和中位價資訊
- 📍 紫色標籤：標記第2步突破點和獲利目標
- 📈 藍色虛線：連接升段的起始和結束點
- 📈 紫色實線：顯示第2步獲利目標線
- ⬆️ 綠色三角形：買入信號（原生段完成）
- ⬆️ 藍色三角形：買入信號（升段確認）
- ⬇️ 紅色三角形：賣出信號（升段結束）
- 📊 資訊面板：即時顯示驗證狀態和第2步監控進度

### 2. Auto Trade v2 (Auto Trade v2.pine)
自動交易策略指標第二版

### 3. Cup & Handle v2 (Cup & Handle v2.pine)  
杯柄形態識別指標第二版

## 🚀 使用方法

1. 打開TradingView平台
2. 進入Pine編輯器
3. 複製對應的.pine文件內容
4. 貼上到Pine編輯器中
5. 點擊"添加到圖表"

## ⚙️ 自訂設定

### 原生段升段交易策略設定選項：

#### 🤖 交易設定
- **啟用自動交易**：開啟/關閉自動交易功能
- **進場方式**：
  - `原生段完成`：在連續3支陽燭完成時立即進場
  - `升段確認`：等待升段趨勢確認後才進場
- **出場方式**：
  - `升段結束`：當升段結束信號出現時出場
  - `固定止損止盈`：使用固定百分比的止損止盈
- **止損百分比**：設定止損點（預設：5%）
- **止盈百分比**：設定止盈點（預設：10%）

#### 🎨 顯示設定
- **顯示原生段標籤**：開啟/關閉原生段標記
- **顯示升段標籤**：開啟/關閉升段標記

#### 🌈 顏色設定
- **原生段標籤顏色**：自訂原生段標籤顏色（預設：綠色）
- **升段標籤顏色**：自訂升段標籤顏色（預設：藍色）
- **升段連線顏色**：自訂升段連線顏色（預設：藍色）

## 📈 交易應用

### 交易邏輯說明
**原生段升段策略的交易意義：**
- **原生段**：代表市場開始出現明確的上升動能
- **升段**：確認上升趨勢的持續，每根K線都創新高且底部抬升
- **升段結束**：預警趨勢可能反轉或進入整理階段

### 🎯 自動交易策略

#### 進場策略
1. **原生段完成進場**：
   - 觸發條件：連續3支陽燭完成
   - 優點：較早進場，獲利空間大
   - 缺點：可能遇到假突破

2. **升段確認進場**：
   - 觸發條件：原生段後出現升段確認信號
   - 優點：趨勢確認度高，成功率較高
   - 缺點：進場較晚，獲利空間相對較小

#### 出場策略
1. **升段結束出場**：
   - 觸發條件：高點低於前高，低點低於前低
   - 適合：趨勢跟隨型交易者

2. **固定止損止盈**：
   - 觸發條件：價格觸及預設的止損或止盈點
   - 適合：風險控制型交易者

### 💡 建議使用方式：
1. **新手建議**：使用"升段確認"進場 + "固定止損止盈"出場
2. **進階交易者**：使用"原生段完成"進場 + "升段結束"出場
3. **保守型**：適當調低止盈目標，提高勝率
4. **積極型**：適當放寬止損範圍，追求更大利潤

## 🔧 技術要求

- TradingView Pine Script v5
- 支援所有時間框架
- 適用於所有金融商品（股票、外匯、加密貨幣等）

## 📁 文件結構

```
/
├── 原生段升段檢測.pine          # 原生段升段檢測指標
├── Auto Trade v2.pine          # 自動交易策略v2
├── Cup & Handle v2.pine        # 杯柄形態識別v2
├── readme.md                   # 專案說明文件
├── .gitignore                  # Git忽略文件配置
└── .github/                    # GitHub配置文件夾
    └── instructions/
        └── instructions.instructions.md
```

## 📋 長期記錄區

### 開發記錄
- **2025-09-15**：
  - 創建原生段升段檢測指標，實現連續3支陽燭檢測和升段趨勢追蹤功能
  - 指標具備完整的視覺提示系統，包括背景顏色變化、標籤標記和趨勢線繪製
  - 實現了狀態表格顯示，方便用戶理解當前市場狀態
  - **升級為策略版本**：加入完整的自動交易功能
  - 支援多種進場和出場方式，適應不同交易風格
  - 加入交易信號視覺化，包括買入賣出箭頭標記
  - 完善風險控制機制，支援固定止損止盈
  - **重要邏輯優化**：修改升段結束條件，從「同時滿足」改為「任一滿足」，提升策略靈敏度

### 重要特性
- 所有指標都基於Pine Script v5開發
- 支援自訂顏色和顯示選項
- 具備完整的視覺化反饋系統
- 適用於多種金融商品和時間週期
- **完整的自動交易功能**：支援多種進出場策略
- **智能風險控制**：內建止損止盈機制
- **即時交易狀態監控**：清楚顯示當前持倉和信號狀態

### 注意事項
- 指標僅供參考，不構成投資建議
- 建議結合其他技術分析工具使用
- 在實際交易前請先進行充分的回測驗證

---

## 📋 長期記錄區

### 2024-12-21 重大功能更新

#### ✅ 新增升段中位價計算功能（含位置資訊）
- **重新定義升段**：將整個從「原生段」開始到「升段結束」的完整期間定義為"升段"
- **中位價計算**：使用兩個關鍵價位計算中位價
  - **開市價**：原生段第一支K線的開市價
  - **收市價**：升段結束前1支K線的收市價
  - **公式**：中位價 = (開市價 + 收市價) / 2
- **位置追蹤**：記錄升段開始和結束的K線位置（bar_index）及對應價位
- **視覺化顯示**：
  - 升段結束標籤顯示完整資訊：「升段結束\\n中位價: XX.XX\\n開始開市: XX.XX\\n結束收市: XX.XX」
  - 資訊表格新增三個欄位：
    - 「升段中位價」：顯示計算出的中位價
    - 「開始開市價」：顯示開始位置和開市價位（格式：位置@價位）
    - 「結束收市價」：顯示結束位置和收市價位（格式：位置@價位）
- **技術實現**：精簡計算邏輯，直接使用兩個關鍵價位進行計算

#### ✅ 新增中點價位檢查功能
- **功能說明**：在升段結束時，計算「原生段開始K線開市價」與「升段結束前1支K線收市價」的中點價位
- **歷史分析**：檢查過去100根K線的最高價是否超過此中點價位
- **視覺化改進**：
  - 升段結束標籤整合所有資訊：「升段結束\\n中位價: XX.XX\\n開始: 位置@價位\\n結束: 位置@價位 ✓/✗」
  - 資訊表格新增「中點檢查」欄位，即時顯示驗證狀態
- **技術實現**：使用全局範圍計算ta.highest()避免Pine Script作用域限制

#### ✅ 升段結束條件優化
- **邏輯改進**：將結束條件從「高點<前高 AND 低點<前低」改為「高點<前高 OR 低點<前低」
- **效果提升**：更早捕捉升段結束信號，避免過度延遲出場
- **風險控制**：提高策略的靈敏度和反應速度

#### ✅ 代碼穩定性提升
- **語法優化**：解決Pine Script v5的函數作用域問題
- **編譯修復**：確保所有版本都能正確編譯和運行
- **變數管理**：優化變數命名和作用域管理

### 技術架構記錄
- **Pine Script版本**：v5
- **策略類型**：strategy()函數，支援實盤交易
- **視覺元素**：背景顏色、標籤、連線、形狀、表格
- **核心演算法**：連續陽燭檢測 + 升段趨勢確認 + 中點價位驗證 + 升段中位價計算
- **數據結構**：使用array<float>動態陣列記錄升段期間價格數據